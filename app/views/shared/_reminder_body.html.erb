<% if render_mail_text %>
    <p><%= @candidate.candidate_sheet.first_name %>,</p>
<% else %>
    <%= label_tag('mail[subject]', t('email.subject_label')) %>:
    <%= text_area_tag('mail[subject]', t('email.subject_initial_text')) %> <br/>
<% end %>

<% if render_mail_text %>
    <p id="late_events_text"><%= @pre_late_text %></p>
<% else %>
    <%= label_tag('mail[pre_late_input]', t('email.pre_late_label')) %>:
    <%= text_area_tag('mail[pre_late_input]', t('email.late_initial_text')) %> <br/>
<% end %>

<% if render_mail_text %>
    <%= render partial: 'shared/reminder_table',
               :locals => {event_key: 'late_events',
                           headers: [t('email.late_events')],
                           events: @late_events,
                           past_due: Proc.new { |candidate_event| nil }
               } %>
<% end %>

<% if render_mail_text %>
    <p id="coming_due_events_text"><%= @pre_coming_due_text %></p>
<% else %>
    <%= label_tag('mail[pre_coming_due_input]', t('email.coming_due_label')) %>:
    <%= text_area_tag('mail[pre_coming_due_input]', t('email.coming_due_initial_text')) %> <br/>
<% end %>

<% if render_mail_text %>
    <%= render partial: 'shared/reminder_table',
               :locals => {event_key: 'coming_due_events',
                           headers: [t('email.events'), t('email.due_date')],
                           events: @coming_due_events,
                           past_due: Proc.new { |candidate_event| candidate_event.due_date }
               } %>
<% end %>

<% if render_mail_text %>
    <p id="completed_events_text"><%= @completed_text %></p>
<% else %>
    <%= label_tag('mail[completed_input]', t('email.completed_label')) %>:
    <%= text_area_tag('mail[completed_input]', t('email.completed_initial_text')) %> <br/>
<% end %>

<% if render_mail_text %>
    <table id="completed_events_table" class="table table-hover">
      <tr id="completed_events_header">
        <th><%= t('email.completed_events') %></th>
        <th><%= t('email.verify') %></th>
      </tr>
      <% @completed_events.each do |candidate_event| %>
          <tr id="completed_events_tr<%= candidate_event.id %>">
            <td id="<%= "completed_events_td0#{candidate_event.id}" %>"><%= candidate_event.name %></td>
            <td id="<%= "completed_events_td1#{candidate_event.id}" %>">
              <ul id="completed_events_ul<%= candidate_event.id %>">
                <% candidate_event.verifiable_info.each do |key, value| %>
                    <li><%= "#{key.to_s}: #{value}" %></li>
                <% end %>
              </ul>
          </tr>
      <% end %>
    </table>
<% end %>

<% if render_mail_text %>
    <p id="closing_text"><%= @closing_text %></p>
<% else %>
    <%= label_tag('mail[closing_text]', t('email.closing_label')) %>:
    <%= text_area_tag('mail[closing_text]', t('email.closing_initial_text')) %> <br/>
<% end %>

<% if render_mail_text %>
    <p id="salutation_text"><%= @salutation_text %></p>
<% else %>
    <%= label_tag('mail[salutation_text]', t('email.salutation_label')) %>:
    <%= text_area_tag('mail[salutation_text]', t('email.salutation_initial_text')) %> <br/>
<% end %>

<% if render_mail_text %>
    <p id="from_text"><%= @from_text %></p>
<% else %>
    <%= label_tag('mail[from_text]', t('email.from_label')) %>:
    <%= text_area_tag('mail[from_text]', t('email.from_initial_text')) %> <br/>
<% end %>
